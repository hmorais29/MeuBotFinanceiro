<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seleção de Instrumentos - Trading Bot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .card {
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: bold;
            border-radius: 10px 10px 0 0 !important;
        }
        
        .selected-instrument {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .remove-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .dropdown-toggle {
            width: 100%;
            text-align: left;
        }
        
        .dropdown-menu {
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .dropdown-header {
            background: var(--primary-color);
            color: white;
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 0;
        }
        
        .dropdown-item {
            padding: 10px 20px;
            border-bottom: 1px solid #eee;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
        }
        
        .symbol-code {
            color: var(--secondary-color);
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .instrument-name {
            color: #666;
            font-size: 0.9em;
        }
        
        .max-instruments-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #664d03;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-chart-line me-2"></i>
                        Instrumentos Selecionados (Máx. 2)
                    </div>
                    <div class="card-body">
                        <!-- Instrumentos selecionados -->
                        <div id="selectedInstruments">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                        
                        <!-- Aviso quando atingir máximo -->
                        <div id="maxWarning" class="max-instruments-warning" style="display: none;">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Máximo de 2 instrumentos atingido. Remove um instrumento para adicionar outro.
                        </div>
                        
                        <!-- Dropdown de seleção -->
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="instrumentDropdown" data-bs-toggle="dropdown">
                                <i class="fas fa-plus me-2"></i>
                                Adicionar Instrumento
                            </button>
                            <ul class="dropdown-menu" id="instrumentDropdownMenu">
                                <!-- Índices -->
                                <li><h6 class="dropdown-header"><i class="fas fa-chart-bar me-2"></i>Índices</h6></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^GSPC" data-name="S&P 500">
                                    <div class="symbol-code">^GSPC</div>
                                    <div class="instrument-name">S&P 500</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^DJI" data-name="Dow Jones Industrial Average">
                                    <div class="symbol-code">^DJI</div>
                                    <div class="instrument-name">Dow Jones Industrial Average</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^IXIC" data-name="NASDAQ Composite">
                                    <div class="symbol-code">^IXIC</div>
                                    <div class="instrument-name">NASDAQ Composite</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^RUT" data-name="Russell 2000">
                                    <div class="symbol-code">^RUT</div>
                                    <div class="instrument-name">Russell 2000</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^FTSE" data-name="FTSE 100">
                                    <div class="symbol-code">^FTSE</div>
                                    <div class="instrument-name">FTSE 100</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^GDAXI" data-name="DAX">
                                    <div class="symbol-code">^GDAXI</div>
                                    <div class="instrument-name">DAX</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^FCHI" data-name="CAC 40">
                                    <div class="symbol-code">^FCHI</div>
                                    <div class="instrument-name">CAC 40</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^N225" data-name="Nikkei 225">
                                    <div class="symbol-code">^N225</div>
                                    <div class="instrument-name">Nikkei 225</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^HSI" data-name="Hang Seng Index">
                                    <div class="symbol-code">^HSI</div>
                                    <div class="instrument-name">Hang Seng Index</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="^AXJO" data-name="ASX 200">
                                    <div class="symbol-code">^AXJO</div>
                                    <div class="instrument-name">ASX 200</div>
                                </a></li>
                                
                                <li><hr class="dropdown-divider"></li>
                                
                                <!-- Ações -->
                                <li><h6 class="dropdown-header"><i class="fas fa-building me-2"></i>Ações</h6></li>
                                <li><a class="dropdown-item" href="#" data-symbol="AAPL" data-name="Apple Inc.">
                                    <div class="symbol-code">AAPL</div>
                                    <div class="instrument-name">Apple Inc.</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="MSFT" data-name="Microsoft Corporation">
                                    <div class="symbol-code">MSFT</div>
                                    <div class="instrument-name">Microsoft Corporation</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="GOOGL" data-name="Alphabet Inc.">
                                    <div class="symbol-code">GOOGL</div>
                                    <div class="instrument-name">Alphabet Inc.</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="AMZN" data-name="Amazon.com Inc.">
                                    <div class="symbol-code">AMZN</div>
                                    <div class="instrument-name">Amazon.com Inc.</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="TSLA" data-name="Tesla Inc.">
                                    <div class="symbol-code">TSLA</div>
                                    <div class="instrument-name">Tesla Inc.</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="META" data-name="Meta Platforms Inc.">
                                    <div class="symbol-code">META</div>
                                    <div class="instrument-name">Meta Platforms Inc.</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="NVDA" data-name="NVIDIA Corporation">
                                    <div class="symbol-code">NVDA</div>
                                    <div class="instrument-name">NVIDIA Corporation</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="BRK-B" data-name="Berkshire Hathaway">
                                    <div class="symbol-code">BRK-B</div>
                                    <div class="instrument-name">Berkshire Hathaway</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="JNJ" data-name="Johnson & Johnson">
                                    <div class="symbol-code">JNJ</div>
                                    <div class="instrument-name">Johnson & Johnson</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="V" data-name="Visa Inc.">
                                    <div class="symbol-code">V</div>
                                    <div class="instrument-name">Visa Inc.</div>
                                </a></li>
                                
                                <li><hr class="dropdown-divider"></li>
                                
                                <!-- Commodities -->
                                <li><h6 class="dropdown-header"><i class="fas fa-coins me-2"></i>Commodities</h6></li>
                                <li><a class="dropdown-item" href="#" data-symbol="GC=F" data-name="Gold">
                                    <div class="symbol-code">GC=F</div>
                                    <div class="instrument-name">Gold</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="SI=F" data-name="Silver">
                                    <div class="symbol-code">SI=F</div>
                                    <div class="instrument-name">Silver</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="CL=F" data-name="Crude Oil WTI">
                                    <div class="symbol-code">CL=F</div>
                                    <div class="instrument-name">Crude Oil WTI</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="BZ=F" data-name="Brent Crude Oil">
                                    <div class="symbol-code">BZ=F</div>
                                    <div class="instrument-name">Brent Crude Oil</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="NG=F" data-name="Natural Gas">
                                    <div class="symbol-code">NG=F</div>
                                    <div class="instrument-name">Natural Gas</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="HG=F" data-name="Copper">
                                    <div class="symbol-code">HG=F</div>
                                    <div class="instrument-name">Copper</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="PL=F" data-name="Platinum">
                                    <div class="symbol-code">PL=F</div>
                                    <div class="instrument-name">Platinum</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="PA=F" data-name="Palladium">
                                    <div class="symbol-code">PA=F</div>
                                    <div class="instrument-name">Palladium</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="ZC=F" data-name="Corn">
                                    <div class="symbol-code">ZC=F</div>
                                    <div class="instrument-name">Corn</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="ZS=F" data-name="Soybeans">
                                    <div class="symbol-code">ZS=F</div>
                                    <div class="instrument-name">Soybeans</div>
                                </a></li>
                                
                                <li><hr class="dropdown-divider"></li>
                                
                                <!-- Crypto -->
                                <li><h6 class="dropdown-header"><i class="fab fa-bitcoin me-2"></i>Criptomoedas</h6></li>
                                <li><a class="dropdown-item" href="#" data-symbol="BTC-USD" data-name="Bitcoin">
                                    <div class="symbol-code">BTC-USD</div>
                                    <div class="instrument-name">Bitcoin</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="ETH-USD" data-name="Ethereum">
                                    <div class="symbol-code">ETH-USD</div>
                                    <div class="instrument-name">Ethereum</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="BNB-USD" data-name="Binance Coin">
                                    <div class="symbol-code">BNB-USD</div>
                                    <div class="instrument-name">Binance Coin</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="XRP-USD" data-name="XRP">
                                    <div class="symbol-code">XRP-USD</div>
                                    <div class="instrument-name">XRP</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="ADA-USD" data-name="Cardano">
                                    <div class="symbol-code">ADA-USD</div>
                                    <div class="instrument-name">Cardano</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="SOL-USD" data-name="Solana">
                                    <div class="symbol-code">SOL-USD</div>
                                    <div class="instrument-name">Solana</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="DOGE-USD" data-name="Dogecoin">
                                    <div class="symbol-code">DOGE-USD</div>
                                    <div class="instrument-name">Dogecoin</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="DOT-USD" data-name="Polkadot">
                                    <div class="symbol-code">DOT-USD</div>
                                    <div class="instrument-name">Polkadot</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="AVAX-USD" data-name="Avalanche">
                                    <div class="symbol-code">AVAX-USD</div>
                                    <div class="instrument-name">Avalanche</div>
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-symbol="MATIC-USD" data-name="Polygon">
                                    <div class="symbol-code">MATIC-USD</div>
                                    <div class="instrument-name">Polygon</div>
                                </a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Área de informações das APIs -->
                <div class="card mt-4">
                    <div class="card-header">
                        <i class="fas fa-info-circle me-2"></i>
                        Estado das APIs
                    </div>
                    <div class="card-body">
                        <div id="apiStatus">
                            <!-- Será preenchido via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Estado dos instrumentos selecionados
        let selectedInstruments = [];
        const MAX_INSTRUMENTS = 2;

        // Carrega estado inicial
        document.addEventListener('DOMContentLoaded', function() {
            updateSelectedInstruments();
            loadAPIStatus();
        });

        // Event listener para seleção de instrumentos
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                const symbol = this.dataset.symbol;
                const name = this.dataset.name;
                
                // Verifica se já está selecionado
                if (selectedInstruments.find(inst => inst.symbol === symbol)) {
                    alert('Este instrumento já está selecionado!');
                    return;
                }
                
                // Verifica limite máximo
                if (selectedInstruments.length >= MAX_INSTRUMENTS) {
                    alert(`Máximo de ${MAX_INSTRUMENTS} instrumentos permitido. Remove um primeiro.`);
                    return;
                }
                
                // Adiciona instrumento
                selectedInstruments.push({ symbol, name });
                updateSelectedInstruments();
                
                // Fecha dropdown
                const dropdown = bootstrap.Dropdown.getInstance(document.getElementById('instrumentDropdown'));
                if (dropdown) {
                    dropdown.hide();
                }
            });
        });

        function removeInstrument(symbol) {
            selectedInstruments = selectedInstruments.filter(inst => inst.symbol !== symbol);
            updateSelectedInstruments();
        }

        function updateSelectedInstruments() {
            const container = document.getElementById('selectedInstruments');
            const warning = document.getElementById('maxWarning');
            const dropdown = document.getElementById('instrumentDropdown');
            
            // Mostra/esconde aviso de máximo
            if (selectedInstruments.length >= MAX_INSTRUMENTS) {
                warning.style.display = 'block';
                dropdown.disabled = true;
                dropdown.classList.add('disabled');
            } else {
                warning.style.display = 'none';
                dropdown.disabled = false;
                dropdown.classList.remove('disabled');
            }
            
            // Atualiza lista de instrumentos selecionados
            if (selectedInstruments.length === 0) {
                container.innerHTML = '<p class="text-muted text-center mb-3"><i class="fas fa-chart-line me-2"></i>Nenhum instrumento selecionado</p>';
            } else {
                container.innerHTML = selectedInstruments.map(inst => `
                    <div class="selected-instrument">
                        <button class="remove-btn" onclick="removeInstrument('${inst.symbol}')" title="Remover">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="symbol-code" style="font-size: 1.2em; margin-bottom: 5px;">${inst.symbol}</div>
                        <div style="opacity: 0.9;">${inst.name}</div>
                    </div>
                `).join('');
            }
        }

        function loadAPIStatus() {
            // Simula carregamento do estado das APIs
            // Em produção, faria uma chamada AJAX para /api/status
            const apiStatus = document.getElementById('apiStatus');
            
            apiStatus.innerHTML = `
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-circle text-success me-2"></i>yfinance</span>
                            <span class="text-muted">Livre (fallback primário)</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-circle text-warning me-2"></i>Finnhub</span>
                            <span class="text-muted">45/60 calls restantes</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-circle text-info me-2"></i>Twelve Data</span>
                            <span class="text-muted">6/8 calls restantes</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-circle text-success me-2"></i>Alpha Vantage</span>
                            <span class="text-muted">5/5 calls restantes</span>
                        </div>
                    </div>
                </div>
                <hr>
                <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    O sistema usa fallback automático: yfinance → Finnhub → Twelve Data → Alpha Vantage
                </small>
            `;
        }
    </script>
</body>
</html>